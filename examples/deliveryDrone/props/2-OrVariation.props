// ======================================================
// 0. Basic reachability / sanity
// ======================================================

// Probability that the top-level goal G0 eventually succeeds
P=? [ F (G0_achieved=1) ];

// Each main subgoal is eventually (possibly) achieved
P=? [ F (G1_achieved=1) ];
P=? [ F (G2_achieved=1) ];
P=? [ F (G3_achieved=1) ];


// ======================================================
// 1. Sequential AND semantics
//    G0: [G1; G2; G3]
// ======================================================

// G2 is only pursued after G1 has been achieved
P>=1 [ G (G2_pursued=1 => G1_achieved=1) ];

// G3 is only pursued after both G1 and G2 have been achieved
P>=1 [ G (G3_pursued=1 => (G1_achieved=1 & G2_achieved=1)) ];

// No overlap between sequential subgoals of G0
P>=1 [ G !( (G1_pursued=1 & G2_pursued=1)
         | (G2_pursued=1 & G3_pursued=1) ) ];

// Sanity: along some path, we actually visit each subgoal while pursuing G0
P>0 [ F (G0_pursued=1 & G1_pursued=1) ];
P>0 [ F (G0_pursued=1 & G2_pursued=1) ];
P>0 [ F (G0_pursued=1 & G3_pursued=1) ];


// ======================================================
// 2. Sequential AND semantics
//    G1: Navigate [T1; T2]
// ======================================================

// T2 (Follow waypoint) is only pursued after T1 (Acquire GPS) is achieved
P>=1 [ G (T2_pursued=1 => T1_achieved=1) ];

// There exists a path where G1 is pursued, T1 is pursued first, then T2
P>0 [ F (G1_pursued=1 & T1_pursued=1 & T2_pursued=0) ];
P>0 [ F (G1_achieved=1 & T1_achieved=1 & T2_achieved=1) ];


// ======================================================
// 3. Alternative OR semantics
//    G2: Ensure safe flight [G4 | G5]
//    (Visual avoidance vs Lidar avoidance)
// ======================================================

// Mutual exclusion: visual and lidar avoidance branches are never pursued simultaneously
P>=1 [ G !(G4_pursued=1 & G5_pursued=1) ];

// While G2 is active and G4 is the chosen branch, G5 is not pursued
P>=1 [ G ( (G2_pursued=1 & G2_achieved=0 & G4_pursued=1)
           => G5_pursued=0 ) ];

// While G2 is active and G5 is the chosen branch, G4 is not pursued
P>=1 [ G ( (G2_pursued=1 & G2_achieved=0 & G5_pursued=1)
           => G4_pursued=0 ) ];

// Coverage: both branches are reachable as refinements of G2
P>0 [ F (G2_pursued=1 & G4_pursued=1) ];
P>0 [ F (G2_pursued=1 & G5_pursued=1) ];

// Refinement correctness: achieving G2 implies at least one branch goal is achieved
P>=1 [ G (G2_achieved=1 => (G4_achieved=1 | G5_achieved=1)) ];


// ======================================================
// 4. Quantitative overall achievability
// ======================================================

// Probability to eventually achieve each leaf task
P=? [ F (T1_achieved=1) ];
P=? [ F (T2_achieved=1) ];
P=? [ F (T3_achieved=1) ];
P=? [ F (T4_achieved=1) ];
P=? [ F (T5_achieved=1) ];

// Already at top: P=? [ F (G0_achieved=1) ];
// This can be compared (offline) with the analytic G0_achievable formula.